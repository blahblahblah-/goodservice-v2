class LongTermServiceChangeRoutingManager
  F_TRAIN_ROUTING_N = ["D43", "D42", "F39", "F38", "F36", "F35", "F34", "F33", "F32", "F31", "F30", "F29", "F27", "F26", "F25", "F24", "F23", "F22", "F21", "F20", "A41", "F18", "F16", "F15", "F14", "D21", "D20", "D19", "D18", "D17", "D16", "D15", "B10", "B08", "B06", "B04", "G14", "G08", "F07", "F06", "F05", "F04", "F03", "F02", "F01"]

  SCHEDULED_ROUTING_OVERRIDES = {
    "F" => {
      north: [
        LongTermServiceChangeRegularRouting.all_times("F", :north, F_TRAIN_ROUTING_N),
      ],
      south: [
        LongTermServiceChangeRegularRouting.all_times("F", :south, F_TRAIN_ROUTING_N.reverse),
      ]
    },
    "7X" => {
      north: [
        LongTermServiceChangeRegularRouting.new("7X", :north, "14:46:00",
          {
            "726" => "21:40:30",
            "725" => "21:43:00",
            "724" => "21:44:30",
            "723" => "21:46:00",
            "721" => "21:50:30",
            "720" => "21:51:30",
            "719" => "21:53:30",
            "718" => "21:55:00",
            "712" => "22:00:00",
            "707" => "22:03:30",
            "702" => "22:07:00",
            "701" => "22:10:30",
          },
          true, false, false),
      ],
      south: [
        LongTermServiceChangeRegularRouting.new("7X", :south, "06:21:00",
          {
            "701" => "09:53:00",
            "702" => "09:55:30",
            "707" => "09:59:30",
            "712" => "10:03:30",
            "718" => "10:09:00",
            "719" => "10:14:30",
            "720" => "10:16:30",
            "721" => "10:17:30",
            "723" => "10:22:30",
            "724" => "10:24:00",
            "725" => "10:25:30",
            "726" => "10:28:30",
          },
          true, false, false),
      ]
    },
    "E" => {
      north: [
        # Weekdays
        LongTermServiceChangeRegularRouting.new("E", :north, "00:00:00", # N05R
          {
            "E01" => "05:38:00",
            "A34" => "05:40:00",
            "A33" => "05:41:30",
            "A32" => "05:43:30",
            "A31" => "05:45:30",
            "A30" => "05:47:00",
            "A28" => "05:49:00",
            "A27" => "05:50:00",
            "A25" => "05:51:30",
            "D14" => "05:53:00",
            "F12" => "05:54:00",
            "F11" => "05:55:30",
            "F09" => "05:58:30",
            "G21" => "06:00:00",
            "G20" => "06:02:00",
            "G19" => "06:04:00",
            "G18" => "06:05:30",
            "G16" => "06:07:00",
            "G15" => "06:08:00",
            "G14" => "06:09:30",
            "G13" => "06:11:00",
            "G12" => "06:12:30",
            "G11" => "06:14:30",
            "G10" => "06:15:30",
            "G09" => "06:17:30",
            "G08" => "06:19:00",
            "F07" => "06:21:00",
            "F06" => "06:22:30",
            "F05" => "06:24:30",
            "G07" => "06:26:00",
            "G06" => "06:28:30",
            "G05" => "06:32:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "05:53:00", # N72R
          {
            "E01" => "06:52:30",
            "A34" => "06:54:30",
            "A33" => "06:56:00",
            "A32" => "06:58:00",
            "A31" => "07:00:30",
            "A30" => "07:02:00",
            "A28" => "07:04:00",
            "A27" => "07:05:30",
            "A25" => "07:07:30",
            "D14" => "07:09:00",
            "F12" => "07:11:30",
            "F11" => "07:13:00",
            "F09" => "07:16:00",
            "G21" => "07:17:30",
            "G14" => "07:23:00",
            "G08" => "07:30:00",
            "F07" => "07:32:00",
            "F06" => "07:33:30",
            "F05" => "07:35:30",
            "G07" => "07:37:00",
            "G06" => "07:39:00",
            "G05" => "07:44:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "07:00:30", # N66R
          {
            "E01" => "19:00:30",
            "A34" => "19:02:30",
            "A33" => "19:04:00",
            "A32" => "19:06:00",
            "A31" => "19:08:30",
            "A30" => "19:10:00",
            "A28" => "19:11:30",
            "A27" => "19:13:00",
            "A25" => "19:15:00",
            "D14" => "19:16:30",
            "F12" => "19:18:00",
            "F11" => "19:19:30",
            "F09" => "19:22:30",
            "G21" => "19:24:00",
            "G14" => "19:29:30",
            "G08" => "19:36:30",
            "F06" => "19:39:00",
            "G07" => "19:42:00",
            "G06" => "19:44:30",
            "G05" => "19:51:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "19:05:30", # N72R
          {
            "E01" => "23:38:00",
            "A34" => "23:40:00",
            "A33" => "23:41:30",
            "A32" => "23:43:30",
            "A31" => "23:45:30",
            "A30" => "23:47:00",
            "A28" => "23:49:00",
            "A27" => "23:50:00",
            "A25" => "23:52:00",
            "D14" => "23:53:30",
            "F12" => "23:54:30",
            "F11" => "23:56:00",
            "F09" => "23:59:00",
            "G21" => "24:00:30",
            "G14" => "24:06:00",
            "G08" => "24:13:00",
            "F07" => "24:15:00",
            "F06" => "24:16:30",
            "F05" => "24:18:30",
            "G07" => "24:20:00",
            "G06" => "24:22:30",
            "G05" => "24:30:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "23:50:00", # N05R
          {
            "E01" => nil,
            "A34" => nil,
            "A33" => nil,
            "A32" => nil,
            "A31" => nil,
            "A30" => nil,
            "A28" => nil,
            "A27" => nil,
            "A25" => nil,
            "D14" => nil,
            "F12" => nil,
            "F11" => nil,
            "F09" => nil,
            "G21" => nil,
            "G20" => nil,
            "G19" => nil,
            "G18" => nil,
            "G16" => nil,
            "G15" => nil,
            "G14" => nil,
            "G13" => nil,
            "G12" => nil,
            "G11" => nil,
            "G10" => nil,
            "G09" => nil,
            "G08" => nil,
            "F07" => nil,
            "F06" => nil,
            "F05" => nil,
            "G07" => nil,
            "G06" => nil,
            "G05" => nil,
          },
          true, false, false),

          # Saturdays
          LongTermServiceChangeRegularRouting.new("E", :north, "00:00:00", # N05R
          {
            "E01" => "05:48:30",
            "A34" => "05:50:30",
            "A33" => "05:52:00",
            "A32" => "05:54:00",
            "A31" => "05:56:00",
            "A30" => "05:57:30",
            "A28" => "05:59:30",
            "A27" => "06:00:30",
            "A25" => "06:02:00",
            "D14" => "06:03:30",
            "F12" => "06:04:30",
            "F11" => "06:06:00",
            "F09" => "06:09:00",
            "G21" => "06:10:30",
            "G20" => "06:12:30",
            "G19" => "06:14:30",
            "G18" => "06:16:00",
            "G16" => "06:17:30",
            "G15" => "06:18:30",
            "G14" => "06:20:00",
            "G13" => "06:21:30",
            "G12" => "06:23:00",
            "G11" => "06:25:00",
            "G10" => "06:26:00",
            "G09" => "06:28:00",
            "G08" => "06:29:30",
            "F07" => "06:31:30",
            "F06" => "06:33:00",
            "F05" => "06:35:00",
            "G07" => "06:38:30",
            "G06" => "06:41:00",
            "G05" => "06:48:00",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "06:08:30", # N72R
          {
            "E01" => "23:36:30",
            "A34" => "23:38:30",
            "A33" => "23:40:00",
            "A32" => "23:42:00",
            "A31" => "23:44:00",
            "A30" => "23:45:30",
            "A28" => "23:47:30",
            "A27" => "23:48:30",
            "A25" => "23:50:30",
            "D14" => "23:52:00",
            "F12" => "23:53:00",
            "F11" => "23:54:30",
            "F09" => "23:57:30",
            "G21" => "23:59:00",
            "G14" => "24:04:30",
            "G08" => "24:11:30",
            "F07" => "24:13:30",
            "F06" => "24:15:00",
            "F05" => "24:17:00",
            "G07" => "24:18:30",
            "G06" => "24:21:00",
            "G05" => "24:30:00",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "23:48:00", # N05R
          {
            "E01" => nil,
            "A34" => nil,
            "A33" => nil,
            "A32" => nil,
            "A31" => nil,
            "A30" => nil,
            "A28" => nil,
            "A27" => nil,
            "A25" => nil,
            "D14" => nil,
            "F12" => nil,
            "F11" => nil,
            "F09" => nil,
            "G21" => nil,
            "G20" => nil,
            "G19" => nil,
            "G18" => nil,
            "G16" => nil,
            "G15" => nil,
            "G14" => nil,
            "G13" => nil,
            "G12" => nil,
            "G11" => nil,
            "G10" => nil,
            "G09" => nil,
            "G08" => nil,
            "F07" => nil,
            "F06" => nil,
            "F05" => nil,
            "G07" => nil,
            "G06" => nil,
            "G05" => nil,
          },
          false, true, false),

        # Sundays
        LongTermServiceChangeRegularRouting.new("E", :north, "00:00:00", # N05R
          {
            "E01" => "05:48:30",
            "A34" => "05:50:30",
            "A33" => "05:52:00",
            "A32" => "05:54:00",
            "A31" => "05:56:00",
            "A30" => "05:57:30",
            "A28" => "05:59:30",
            "A27" => "06:00:30",
            "A25" => "06:02:00",
            "D14" => "06:03:30",
            "F12" => "06:04:30",
            "F11" => "06:06:00",
            "F09" => "06:09:00",
            "G21" => "06:10:30",
            "G20" => "06:12:30",
            "G19" => "06:14:30",
            "G18" => "06:16:00",
            "G16" => "06:17:30",
            "G15" => "06:18:30",
            "G14" => "06:20:00",
            "G13" => "06:21:30",
            "G12" => "06:23:00",
            "G11" => "06:25:00",
            "G10" => "06:26:00",
            "G09" => "06:28:00",
            "G08" => "06:29:30",
            "F07" => "06:31:30",
            "F06" => "06:33:00",
            "F05" => "06:35:00",
            "G07" => "06:38:30",
            "G06" => "06:41:00",
            "G05" => "06:49:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :north, "06:08:30", # N72R
          {
            "E01" => "23:34:30",
            "A34" => "23:36:30",
            "A33" => "23:38:00",
            "A32" => "23:40:00",
            "A31" => "23:42:00",
            "A30" => "23:43:30",
            "A28" => "23:45:30",
            "A27" => "23:46:30",
            "A25" => "23:48:30",
            "D14" => "23:50:00",
            "F12" => "23:51:00",
            "F11" => "23:52:30",
            "F09" => "23:55:30",
            "G21" => "23:57:00",
            "G14" => "24:02:30",
            "G08" => "24:09:30",
            "F07" => "24:11:30",
            "F06" => "24:13:00",
            "F05" => "24:15:00",
            "G07" => "24:16:30",
            "G06" => "24:19:00",
            "G05" => "24:29:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :north, "23:48:30", # N05R
          {
            "E01" => nil,
            "A34" => nil,
            "A33" => nil,
            "A32" => nil,
            "A31" => nil,
            "A30" => nil,
            "A28" => nil,
            "A27" => nil,
            "A25" => nil,
            "D14" => nil,
            "F12" => nil,
            "F11" => nil,
            "F09" => nil,
            "G21" => nil,
            "G20" => nil,
            "G19" => nil,
            "G18" => nil,
            "G16" => nil,
            "G15" => nil,
            "G14" => nil,
            "G13" => nil,
            "G12" => nil,
            "G11" => nil,
            "G10" => nil,
            "G09" => nil,
            "G08" => nil,
            "F07" => nil,
            "F06" => nil,
            "F05" => nil,
            "G07" => nil,
            "G06" => nil,
            "G05" => nil,
          },
          false, false, true),
      ],
      south: [
        # Weekdays
        LongTermServiceChangeRegularRouting.new("E", :south, "00:00:00", # S04R
          {
            "G05" => "05:05:30",
            "G06" => "05:07:00",
            "G07" => "05:09:30",
            "F05" => "05:11:00",
            "F06" => "05:12:30",
            "F07" => "05:14:00",
            "G08" => "05:15:30",
            "G09" => "05:17:00",
            "G10" => "05:19:00",
            "G11" => "05:20:00",
            "G12" => "05:22:00",
            "G13" => "05:23:30",
            "G14" => "05:25:00",
            "G15" => "05:26:30",
            "G16" => "05:28:00",
            "G18" => "05:29:30",
            "G19" => "05:31:00",
            "G20" => "05:33:00",
            "G21" => "05:35:00",
            "F09" => "05:36:30",
            "F11" => "05:39:30",
            "F12" => "05:41:00",
            "D14" => "05:42:30",
            "A25" => "05:44:00",
            "A27" => "05:47:30",
            "A28" => "05:48:30",
            "A30" => "05:50:00",
            "A31" => "05:51:30",
            "A32" => "05:53:30",
            "A33" => "05:55:00",
            "A34" => "05:56:30",
            "E01" => "05:58:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "05:22:30", # S69R
          {
            "G05" => "05:58:00",
            "G06" => "05:59:30",
            "G07" => "06:02:00",
            "F05" => "06:03:30",
            "F06" => "06:05:30",
            "F07" => "06:07:00",
            "G08" => "06:09:00",
            "G14" => "06:16:00",
            "G21" => "06:22:00",
            "F09" => "06:23:30",
            "F11" => "06:26:30",
            "F12" => "06:28:00",
            "D14" => "06:29:30",
            "A25" => "06:31:00",
            "A27" => "06:34:30",
            "A28" => "06:35:30",
            "A30" => "06:37:00",
            "A31" => "06:38:30",
            "A32" => "06:40:30",
            "A33" => "06:42:00",
            "A34" => "06:43:30",
            "E01" => "06:45:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "06:07:00", # S71R
          {
            "G05" => "17:56:00",
            "G06" => "17:57:30",
            "G07" => "18:03:00",
            "F06" => "18:06:00",
            "G08" => "18:08:30",
            "G14" => "18:15:30",
            "G21" => "18:21:30",
            "F09" => "18:23:00",
            "F11" => "18:26:30",
            "F12" => "18:28:30",
            "D14" => "18:30:30",
            "A25" => "18:32:00",
            "A27" => "18:34:00",
            "A28" => "18:35:30",
            "A30" => "18:37:30",
            "A31" => "18:39:00",
            "A32" => "18:41:30",
            "A33" => "18:43:00",
            "A34" => "18:44:30",
            "E01" => "18:46:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "18:02:00", # S69R
          {
            "G05" => "22:30:30",
            "G06" => "22:32:00",
            "G07" => "22:34:30",
            "F05" => "22:36:00",
            "F06" => "22:38:00",
            "F07" => "22:39:30",
            "G08" => "22:41:30",
            "G14" => "22:48:30",
            "G21" => "22:54:30",
            "F09" => "22:56:00",
            "F11" => "22:59:00",
            "F12" => "23:00:30",
            "D14" => "23:02:00",
            "A25" => "23:03:30",
            "A27" => "23:08:30",
            "A28" => "23:09:30",
            "A30" => "23:11:00",
            "A31" => "23:12:30",
            "A32" => "23:14:30",
            "A33" => "23:16:00",
            "A34" => "23:17:30",
            "E01" => "23:19:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "22:36:00", # S04R
          {
            "G05" => nil,
            "G06" => nil,
            "G07" => nil,
            "F05" => nil,
            "F06" => nil,
            "F07" => nil,
            "G08" => nil,
            "G09" => nil,
            "G10" => nil,
            "G11" => nil,
            "G12" => nil,
            "G13" => nil,
            "G14" => nil,
            "G15" => nil,
            "G16" => nil,
            "G18" => nil,
            "G19" => nil,
            "G20" => nil,
            "G21" => nil,
            "F09" => nil,
            "F11" => nil,
            "F12" => nil,
            "D14" => nil,
            "A25" => nil,
            "A27" => nil,
            "A28" => nil,
            "A30" => nil,
            "A31" => nil,
            "A32" => nil,
            "A33" => nil,
            "A34" => nil,
            "E01" => nil,
          },
          true, false, false),

        # Saturdays
        LongTermServiceChangeRegularRouting.new("E", :south, "00:00:00", # S04R
          {
            "G05" => "05:13:30",
            "G06" => "05:15:00",
            "G07" => "05:17:30",
            "F05" => "05:19:00",
            "F06" => "05:20:30",
            "F07" => "05:22:00",
            "G08" => "05:23:30",
            "G09" => "05:25:00",
            "G10" => "05:27:00",
            "G11" => "05:28:00",
            "G12" => "05:30:00",
            "G13" => "05:31:30",
            "G14" => "05:33:00",
            "G15" => "05:34:30",
            "G16" => "05:36:00",
            "G18" => "05:37:30",
            "G19" => "05:39:00",
            "G20" => "05:41:00",
            "G21" => "05:43:00",
            "F09" => "05:44:30",
            "F11" => "05:47:30",
            "F12" => "05:49:00",
            "D14" => "05:50:30",
            "A25" => "05:52:00",
            "A27" => "05:56:30",
            "A28" => "05:57:30",
            "A30" => "05:59:00",
            "A31" => "06:00:30",
            "A32" => "06:02:30",
            "A33" => "06:04:00",
            "A34" => "06:05:30",
            "E01" => "06:10:30",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "05:33:00", # S69R
          {
            "G05" => "22:21:00",
            "G06" => "22:22:30",
            "G07" => "22:24:30",
            "F05" => "22:26:00",
            "F06" => "22:28:00",
            "F07" => "22:29:30",
            "G08" => "22:31:30",
            "G14" => "22:38:30",
            "G21" => "22:44:30",
            "F09" => "22:46:00",
            "F11" => "22:49:00",
            "F12" => "22:50:30",
            "D14" => "22:52:00",
            "A25" => "22:53:30",
            "A27" => "22:58:30",
            "A28" => "22:59:30",
            "A30" => "23:01:00",
            "A31" => "23:02:30",
            "A32" => "23:04:30",
            "A33" => "23:06:00",
            "A34" => "23:07:30",
            "E01" => "23:09:30",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "22:30:00", # S04R
          {
            "G05" => nil,
            "G06" => nil,
            "G07" => nil,
            "F05" => nil,
            "F06" => nil,
            "F07" => nil,
            "G08" => nil,
            "G09" => nil,
            "G10" => nil,
            "G11" => nil,
            "G12" => nil,
            "G13" => nil,
            "G14" => nil,
            "G15" => nil,
            "G16" => nil,
            "G18" => nil,
            "G19" => nil,
            "G20" => nil,
            "G21" => nil,
            "F09" => nil,
            "F11" => nil,
            "F12" => nil,
            "D14" => nil,
            "A25" => nil,
            "A27" => nil,
            "A28" => nil,
            "A30" => nil,
            "A31" => nil,
            "A32" => nil,
            "A33" => nil,
            "A34" => nil,
            "E01" => nil,
          },
          false, true, false),

        # Sundays
        LongTermServiceChangeRegularRouting.new("E", :south, "00:00:00", # S04R
          {
            "G05" => "04:53:30",
            "G06" => "04:55:00",
            "G07" => "04:57:30",
            "F05" => "04:59:00",
            "F06" => "05:00:30",
            "F07" => "05:02:00",
            "G08" => "05:03:30",
            "G09" => "05:05:00",
            "G10" => "05:07:00",
            "G11" => "05:08:00",
            "G12" => "05:10:00",
            "G13" => "05:11:30",
            "G14" => "05:13:00",
            "G15" => "05:14:30",
            "G16" => "05:16:00",
            "G18" => "05:17:30",
            "G19" => "05:19:00",
            "G20" => "05:21:00",
            "G21" => "05:23:00",
            "F09" => "05:24:30",
            "F11" => "05:27:30",
            "F12" => "05:29:00",
            "D14" => "05:30:30",
            "A25" => "05:32:00",
            "A27" => "05:37:00",
            "A28" => "05:38:00",
            "A30" => "05:39:30",
            "A31" => "05:41:00",
            "A32" => "05:43:00",
            "A33" => "05:44:30",
            "A34" => "05:46:00",
            "E01" => "05:51:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :south, "05:13:30", # S69R
          {
            "G05" => "22:18:00",
            "G06" => "22:19:30",
            "G07" => "22:22:00",
            "F05" => "22:23:30",
            "F06" => "22:25:30",
            "F07" => "22:27:00",
            "G08" => "22:29:00",
            "G14" => "22:36:00",
            "G21" => "22:42:00",
            "F09" => "22:43:30",
            "F11" => "22:46:30",
            "F12" => "22:48:00",
            "D14" => "22:49:30",
            "A25" => "22:51:00",
            "A27" => "22:56:00",
            "A28" => "22:57:00",
            "A30" => "22:58:30",
            "A31" => "23:00:00",
            "A32" => "23:02:00",
            "A33" => "23:03:30",
            "A34" => "23:05:00",
            "E01" => "23:07:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :south, "22:28:00", # S04R
          {
            "G05" => nil,
            "G06" => nil,
            "G07" => nil,
            "F05" => nil,
            "F06" => nil,
            "F07" => nil,
            "G08" => nil,
            "G09" => nil,
            "G10" => nil,
            "G11" => nil,
            "G12" => nil,
            "G13" => nil,
            "G14" => nil,
            "G15" => nil,
            "G16" => nil,
            "G18" => nil,
            "G19" => nil,
            "G20" => nil,
            "G21" => nil,
            "F09" => nil,
            "F11" => nil,
            "F12" => nil,
            "D14" => nil,
            "A25" => nil,
            "A27" => nil,
            "A28" => nil,
            "A30" => nil,
            "A31" => nil,
            "A32" => nil,
            "A33" => nil,
            "A34" => nil,
            "E01" => nil,
          },
          false, false, true),
      ]
    },
    "R" => {
      north: [
        # Weekdays
        LongTermServiceChangeRegularRouting.new("R", :north, "00:00:00", # N27R
          {
            "R45" => "05:06:00",
            "R44" => "05:07:30",
            "R43" => "05:09:30",
            "R42" => "05:11:00",
            "R41" => "05:13:00",
            "R40" => "05:14:30",
            "R39" => "05:16:00",
            "R36" => "05:18:30",
            "R35" => "05:20:00",
            "R34" => "05:21:30",
            "R33" => "05:23:30",
            "R32" => "05:25:00",
            "R31" => "05:27:00",
            "R30" => "05:30:00",
            "R29" => "05:31:30",
            "R28" => "05:33:00",
            "R27" => "05:37:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("R", :north, "05:18:30", # N72R
          {
            "R45" => "22:56:30",
            "R44" => "22:58:00",
            "R43" => "23:00:00",
            "R42" => "23:01:30",
            "R41" => "23:03:30",
            "R40" => "23:05:30",
            "R39" => "23:07:00",
            "R36" => "23:09:30",
            "R35" => "23:11:30",
            "R34" => "23:13:00",
            "R33" => "23:15:00",
            "R32" => "23:17:00",
            "R31" => "23:19:00",
            "R30" => "23:22:00",
            "R29" => "23:23:30",
            "R28" => "23:25:00",
            "R27" => "23:28:30",
            "R26" => "23:30:30",
            "R25" => "23:31:30",
            "R24" => "23:33:30",
            "R23" => "23:36:00",
            "R22" => "23:37:30",
            "R21" => "23:39:00",
            "R20" => "23:40:30",
            "R19" => "23:42:00",
            "R18" => "23:43:00",
            "R17" => "23:44:00",
            "R16" => "23:45:30",
            "R15" => "23:47:00",
            "R14" => "23:48:30",
            "R13" => "23:51:00",
            "R11" => "23:52:30",
            "G21" => "23:58:00",
            "G20" => "24:00:00",
            "G19" => "24:02:00",
            "G18" => "24:04:00",
            "G16" => "24:05:30",
            "G15" => "24:07:00",
            "G14" => "24:08:30",
            "G13" => "24:13:00",
            "G12" => "24:14:30",
            "G11" => "24:16:30",
            "G10" => "24:17:30",
            "G09" => "24:19:30",
            "G08" => "24:21:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("R", :north, "22:52:00", # N93R
          {
            "R45" => nil,
            "R44" => nil,
            "R43" => nil,
            "R42" => nil,
            "R41" => nil,
            "R40" => nil,
            "R39" => nil,
            "R36" => nil,
            "R35" => nil,
            "R34" => nil,
            "R33" => nil,
            "R32" => nil,
            "R31" => nil,
            "R30" => nil,
            "R29" => nil,
            "R28" => nil,
            "R27" => nil,
          },
          true, false, false),

          # Saturdays
          LongTermServiceChangeRegularRouting.new("R", :north, "00:00:00", # N27R
          {
            "R45" => "05:06:00",
            "R44" => "05:07:30",
            "R43" => "05:09:30",
            "R42" => "05:11:00",
            "R41" => "05:13:00",
            "R40" => "05:14:30",
            "R39" => "05:16:00",
            "R36" => "05:18:30",
            "R35" => "05:20:00",
            "R34" => "05:21:30",
            "R33" => "05:23:30",
            "R32" => "05:25:00",
            "R31" => "05:27:00",
            "R30" => "05:30:00",
            "R29" => "05:31:30",
            "R28" => "05:33:00",
            "R27" => "05:37:00",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("R", :north, "05:24:00", # N93R
          {
            "R45" => "22:59:00",
            "R44" => "23:00:30",
            "R43" => "23:02:30",
            "R42" => "23:04:00",
            "R41" => "23:06:00",
            "R40" => "23:07:30",
            "R39" => "23:09:00",
            "R36" => "23:11:30",
            "R35" => "23:13:00",
            "R34" => "23:14:30",
            "R33" => "23:16:30",
            "R32" => "23:18:00",
            "R31" => "23:20:00",
            "R30" => "23:23:00",
            "R29" => "23:24:30",
            "R28" => "23:26:00",
            "R27" => "23:29:30",
            "R26" => "23:31:00",
            "R25" => "23:32:30",
            "R24" => "23:34:00",
            "R23" => "23:36:30",
            "R22" => "23:38:00",
            "R21" => "23:39:30",
            "R20" => "23:41:00",
            "R19" => "23:42:30",
            "R18" => "23:43:30",
            "R17" => "23:44:30",
            "R16" => "23:46:00",
            "R15" => "23:47:30",
            "R14" => "23:49:00",
            "R13" => "23:51:30",
            "R11" => "23:53:00",
            "G21" => "23:58:30",
            "G20" => "24:02:00",
            "G19" => "24:04:00",
            "G18" => "24:05:30",
            "G16" => "24:07:00",
            "G15" => "24:08:00",
            "G14" => "24:09:30",
            "G13" => "24:14:00",
            "G12" => "24:15:30",
            "G11" => "24:17:30",
            "G10" => "24:18:30",
            "G09" => "24:20:30",
            "G08" => "24:22:00",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("R", :north, "22:54:00", # N27R
          {
            "R45" => nil,
            "R44" => nil,
            "R43" => nil,
            "R42" => nil,
            "R41" => nil,
            "R40" => nil,
            "R39" => nil,
            "R36" => nil,
            "R35" => nil,
            "R34" => nil,
            "R33" => nil,
            "R32" => nil,
            "R31" => nil,
            "R30" => nil,
            "R29" => nil,
            "R28" => nil,
            "R27" => nil,
          },
          false, true, false),

        # Sundays
        LongTermServiceChangeRegularRouting.new("R", :north, "00:00:00", # N27R
          {
            "R45" => "05:06:00",
            "R44" => "05:07:30",
            "R43" => "05:09:30",
            "R42" => "05:11:00",
            "R41" => "05:13:00",
            "R40" => "05:14:30",
            "R39" => "05:16:00",
            "R36" => "05:18:30",
            "R35" => "05:20:00",
            "R34" => "05:21:30",
            "R33" => "05:23:30",
            "R32" => "05:25:00",
            "R31" => "05:27:00",
            "R30" => "05:30:00",
            "R29" => "05:31:30",
            "R28" => "05:33:00",
            "R27" => "05:37:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("R", :north, "05:26:00", # N93R
          {
            "R45" => "22:57:00",
            "R44" => "22:58:30",
            "R43" => "23:00:30",
            "R42" => "23:02:00",
            "R41" => "23:04:00",
            "R40" => "23:05:30",
            "R39" => "23:07:00",
            "R36" => "23:09:30",
            "R35" => "23:11:00",
            "R34" => "23:12:30",
            "R33" => "23:14:30",
            "R32" => "23:16:00",
            "R31" => "23:18:00",
            "R30" => "23:21:00",
            "R29" => "23:24:30",
            "R28" => "23:26:00",
            "R27" => "23:29:30",
            "R26" => "23:31:00",
            "R25" => "23:32:30",
            "R24" => "23:34:00",
            "R23" => "23:36:30",
            "R22" => "23:38:00",
            "R21" => "23:39:30",
            "R20" => "23:41:00",
            "R19" => "23:42:30",
            "R18" => "23:43:30",
            "R17" => "23:44:30",
            "R16" => "23:46:00",
            "R15" => "23:47:30",
            "R14" => "23:49:00",
            "R13" => "23:51:30",
            "R11" => "23:53:00",
            "G21" => "23:58:30",
            "G20" => "24:02:00",
            "G19" => "24:04:00",
            "G18" => "24:05:30",
            "G16" => "24:07:00",
            "G15" => "24:08:00",
            "G14" => "24:09:30",
            "G13" => "24:14:00",
            "G12" => "24:15:30",
            "G11" => "24:17:30",
            "G10" => "24:18:30",
            "G09" => "24:20:30",
            "G08" => "24:22:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :north, "23:48:30", # N05R
          {
            "R45" => nil,
            "R44" => nil,
            "R43" => nil,
            "R42" => nil,
            "R41" => nil,
            "R40" => nil,
            "R39" => nil,
            "R36" => nil,
            "R35" => nil,
            "R34" => nil,
            "R33" => nil,
            "R32" => nil,
            "R31" => nil,
            "R30" => nil,
            "R29" => nil,
            "R28" => nil,
            "R27" => nil,
          },
          false, false, true),
      ],
      south: [ # No changes to timetable for R southbound
      ],
    },
    "J" => {
      north: [
        LongTermServiceChangeRegularRouting.new("J", :north, "13:12:00", # N45R
          {
            "M23" => "16:48:30",
            "M22" => "16:50:30",
            "M21" => "16:52:00",
            "M20" => "16:54:00",
            "M19" => "16:56:00",
            "M18" => "16:58:00",
            "M16" => "17:05:30",
            "M11" => "17:09:30",
            "J31" => "17:11:30",
            "J30" => "17:13:00",
            "J29" => "17:14:30",
            "J28" => "17:16:00",
            "J27" => "17:17:30",
            "J24" => "17:19:30",
            "J23" => "17:21:00",
            "J22" => "17:22:30",
            "J21" => "17:23:30",
            "J20" => "17:25:30",
            "J19" => "17:27:30",
            "J17" => "17:28:30",
            "J16" => "17:30:00",
            "J15" => "17:32:00",
            "J14" => "17:33:30",
            "J13" => "17:35:30",
            "J12" => "17:37:00",
            "G06" => "17:41:00",
            "G05" => "17:42:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("J", :north, "16:59:30", # N52R (skip-stop)
          {
            "M23" => "16:59:30",
            "M22" => "17:01:30",
            "M21" => "17:03:30",
            "M20" => "17:05:30",
            "M19" => "17:08:00",
            "M18" => "17:10:00",
            "M16" => "17:17:30",
            "M11" => "17:21:30",
            "J31" => "17:23:30",
            "J29" => "17:26:00",
            "J27" => "17:28:30",
            "J24" => "17:30:00",
            "J22" => "17:33:00",
            "J20" => "17:36:00",
            "J19" => "17:38:00",
            "J17" => "17:39:00",
            "J16" => "17:40:30",
            "J15" => "17:42:30",
            "J14" => "17:44:00",
            "J13" => "17:46:00",
            "J12" => "17:47:30",
            "G06" => "17:51:00",
            "G05" => "17:52:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("J", :north, "17:51:30", # N45R
          {
            "M23" => "19:32:00",
            "M22" => "19:33:30",
            "M21" => "19:35:00",
            "M20" => "19:37:00",
            "M19" => "19:39:00",
            "M18" => "19:41:00",
            "M16" => "19:48:30",
            "M11" => "19:52:30",
            "J31" => "19:54:30",
            "J30" => "19:56:00",
            "J29" => "19:57:30",
            "J28" => "19:59:00",
            "J27" => "20:00:30",
            "J24" => "20:02:30",
            "J23" => "20:04:00",
            "J22" => "20:05:30",
            "J21" => "20:06:30",
            "J20" => "20:08:30",
            "J19" => "20:10:30",
            "J17" => "20:11:30",
            "J16" => "20:13:00",
            "J15" => "20:15:00",
            "J14" => "20:16:30",
            "J13" => "20:18:30",
            "J12" => "20:20:00",
            "G06" => "20:24:00",
            "G05" => "20:25:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("J", :north, "19:40:00", # N41R
          {
            "M23" => nil,
            "M22" => nil,
            "M21" => nil,
            "M20" => nil,
            "M19" => nil,
            "M18" => nil,
            "M16" => nil,
            "M14" => nil,
            "M13" => nil,
            "M12" => nil,
            "M11" => nil,
            "J31" => nil,
            "J30" => nil,
            "J29" => nil,
            "J28" => nil,
            "J27" => nil,
            "J24" => nil,
            "J23" => nil,
            "J22" => nil,
            "J21" => nil,
            "J20" => nil,
            "J19" => nil,
            "J17" => nil,
            "J16" => nil,
            "J15" => nil,
            "J14" => nil,
            "J13" => nil,
            "J12" => nil,
            "G06" => nil,
            "G05" => nil,
          },
          true, false, false),
      ],
      south: [
        LongTermServiceChangeRegularRouting.new("J", :south, "06:32:00", # S13R
          {
            "G05" => "07:07:00",
            "G06" => "07:08:00",
            "J12" => "07:12:00",
            "J13" => "07:13:30",
            "J14" => "07:15:30",
            "J15" => "07:17:00",
            "J16" => "07:19:00",
            "J17" => "07:20:30",
            "J19" => "07:22:00",
            "J20" => "07:24:00",
            "J21" => "07:25:30",
            "J22" => "07:27:00",
            "J23" => "07:28:30",
            "J24" => "07:30:00",
            "J27" => "07:32:00",
            "J28" => "07:33:30",
            "J29" => "07:35:00",
            "J30" => "07:36:30",
            "J31" => "07:38:00",
            "M11" => "07:40:00",
            "M16" => "07:44:00",
            "M18" => "07:51:30",
            "M19" => "07:53:00",
            "M20" => "07:54:30",
            "M21" => "07:56:00",
            "M22" => "07:57:00",
            "M23" => "07:58:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("J", :south, "07:14:30", # S25R (skip-stop)
          {
            "G05" => "08:17:30",
            "G06" => "08:18:30",
            "J12" => "08:22:00",
            "J13" => "08:23:30",
            "J14" => "08:25:30",
            "J15" => "08:27:00",
            "J16" => "08:29:00",
            "J17" => "08:30:30",
            "J19" => "08:31:30",
            "J20" => "08:33:30",
            "J22" => "08:36:30",
            "J24" => "08:39:30",
            "J27" => "08:41:00",
            "J29" => "08:43:30",
            "J31" => "08:46:00",
            "M11" => "08:47:30",
            "M16" => "08:51:30",
            "M18" => "08:59:00",
            "M19" => "09:00:30",
            "M20" => "09:02:30",
            "M21" => "09:04:00",
            "M22" => "09:05:30",
            "M23" => "09:07:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("J", :south, "08:22:00", # S13R
          {
            "G05" => "12:25:00",
            "G06" => "12:26:00",
            "J12" => "12:30:00",
            "J13" => "12:31:30",
            "J14" => "12:33:30",
            "J15" => "12:35:00",
            "J16" => "12:37:00",
            "J17" => "12:38:30",
            "J19" => "12:39:30",
            "J20" => "12:41:30",
            "J21" => "12:43:30",
            "J22" => "12:44:30",
            "J23" => "12:46:00",
            "J24" => "12:47:30",
            "J27" => "12:49:30",
            "J28" => "12:53:00",
            "J29" => "12:54:30",
            "J30" => "12:56:00",
            "J31" => "12:57:30",
            "M11" => "12:59:00",
            "M16" => "13:03:00",
            "M18" => "13:10:30",
            "M19" => "13:12:00",
            "M20" => "13:13:30",
            "M21" => "13:15:00",
            "M22" => "13:16:00",
            "M23" => "13:17:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("J", :south, "12:34:00", # S12R
          {
            "G05" => nil,
            "G06" => nil,
            "J12" => nil,
            "J13" => nil,
            "J14" => nil,
            "J15" => nil,
            "J16" => nil,
            "J17" => nil,
            "J19" => nil,
            "J20" => nil,
            "J21" => nil,
            "J22" => nil,
            "J23" => nil,
            "J24" => nil,
            "J27" => nil,
            "J28" => nil,
            "J29" => nil,
            "J30" => nil,
            "J31" => nil,
            "M11" => nil,
            "M12" => nil,
            "M13" => nil,
            "M14" => nil,
            "M16" => nil,
            "M18" => nil,
            "M19" => nil,
            "M20" => nil,
            "M21" => nil,
            "M22" => nil,
            "M23" => nil,
          },
          true, false, false),
      ],
    },
    "Z" => {
      north: [
        LongTermServiceChangeRegularRouting.new("Z", :north, "16:54:30", # N51R
          {
            "M23" => "17:45:00",
            "M22" => "17:47:00",
            "M21" => "17:49:00",
            "M20" => "17:51:00",
            "M19" => "17:53:00",
            "M18" => "17:55:00",
            "M16" => "18:02:30",
            "M11" => "18:06:30",
            "J30" => "18:09:30",
            "J28" => "18:12:00",
            "J27" => "18:13:00",
            "J24" => "18:14:30",
            "J23" => "18:16:00",
            "J21" => "18:18:30",
            "J20" => "18:20:30",
            "J19" => "18:22:00",
            "J17" => "18:23:00",
            "J16" => "18:24:30",
            "J15" => "18:26:00",
            "J14" => "18:27:30",
            "J13" => "18:29:00",
            "J12" => "18:30:30",
            "G06" => "18:34:30",
            "G05" => "18:35:30",
          },
          true, false, false),
      ],
      south: [
        LongTermServiceChangeRegularRouting.new("Z", :south, "07:21:00", # S26R
          {
            "G05" => "08:12:30",
            "G06" => "08:13:30",
            "J12" => "08:17:30",
            "J13" => "08:19:00",
            "J14" => "08:20:30",
            "J15" => "08:22:00",
            "J16" => "08:23:30",
            "J17" => "08:25:00",
            "J19" => "08:26:00",
            "J20" => "08:27:30",
            "J21" => "08:29:30",
            "J23" => "08:32:00",
            "J24" => "08:33:30",
            "J27" => "08:35:00",
            "J28" => "08:36:00",
            "J30" => "08:38:30",
            "M11" => "08:41:30",
            "M16" => "08:45:30",
            "M18" => "08:53:00",
            "M19" => "08:54:30",
            "M20" => "08:56:30",
            "M21" => "08:58:00",
            "M22" => "08:59:30",
            "M23" => "09:01:00",
          },
          true, false, false),
      ],
    },
  }

  DAY_OF_WEEK_OVERRIDE = {
    Date.parse("Thu, 23 Nov 2023") => "Sunday"
  }


  def self.get_routing(route_id, direction, time = Scheduled::StopTime.rounded_time)
    return [] unless ENV["SIXTY_THIRD_STREET_SERVICE_CHANGES"] == "true"

    current_timestamp = Time.zone.at(time)
    schedule = SCHEDULED_ROUTING_OVERRIDES[route_id].try(:[], direction)

    return [] unless schedule.present?
    timestamp_from_beginning_of_day = current_timestamp - current_timestamp.beginning_of_day
    today = Date.current
    yesterday = today - 1.day
    current_day_of_week = DAY_OF_WEEK_OVERRIDE[today] || get_schedule(today)
    prev_day_of_week = DAY_OF_WEEK_OVERRIDE[yesterday] || get_schedule(yesterday)

    # Consolidate routings
    routings = schedule.map { |s|
      s.get_applicable_routing(timestamp_from_beginning_of_day, current_day_of_week, prev_day_of_week)
    }.compact.flatten(1)
    routings.select { |selected_routing|
      others = routings - [selected_routing]
      selected_routing.length > 0 && others.none? {|o| o.each_cons(selected_routing.length).any?(&selected_routing.method(:==))}
    }
  end

  def self.get_all_routings(time = Scheduled::StopTime.rounded_time)
    return {} unless ENV["SIXTY_THIRD_STREET_SERVICE_CHANGES"] == "true"

    SCHEDULED_ROUTING_OVERRIDES.keys.to_h { |route_id|
      [route_id, [:north, :south].to_h { |direction|
          [direction, get_routing(route_id, direction, time)]
        }
      ]
    }
  end

  def self.get_schedule(date)
    if date.saturday?
      "Saturday"
    elsif date.sunday?
      "Sunday"
    else
      "Weekday"
    end
  end
end