class LongTermServiceChangeRoutingManager
  F_TRAIN_ROUTING_N = ["D43", "D42", "F39", "F38", "F36", "F35", "F34", "F33", "F32", "F31", "F30", "F29", "F27", "F26", "F25", "F24", "F23", "F22", "F21", "F20", "A41", "F18", "F16", "F15", "F14", "D21", "D20", "D19", "D18", "D17", "D16", "D15", "B10", "B08", "B06", "B04", "G14", "G08", "F07", "F06", "F05", "F04", "F03", "F02", "F01"]

  SCHEDULED_ROUTING_OVERRIDES = {
    "F" => {
      north: [
        LongTermServiceChangeRegularRouting.all_times("F", :north, F_TRAIN_ROUTING_N),
      ],
      south: [
        LongTermServiceChangeRegularRouting.all_times("F", :south, F_TRAIN_ROUTING_N.reverse),
      ]
    },
    "FX" => {
      north: [
        LongTermServiceChangeRegularRouting.new("FX", :north, "07:07:30",
          {
            "D43" => "07:29:00",
            "D42" => "07:30:30",
            "F39" => "07:32:00",
            "F38" => "07:34:30",
            "F36" => "07:36:30",
            "F35" => "07:38:30",
            "F34" => "07:40:00",
            "F33" => "07:42:00",
            "F32" => "07:43:30",
            "F31" => "07:44:30",
            "F30" => "07:46:00",
            "F29" => "07:48:00",
            "F27" => "07:50:00",
            "F24" => "07:53:00",
            "A41" => "07:58:30",
            "F18" => "08:00:00",
            "F16" => "08:04:00",
            "F15" => "08:05:30",
            "F14" => "08:07:00",
            "D21" => "08:08:30",
            "D20" => "08:11:00",
            "D19" => "08:13:00",
            "D18" => "08:14:30",
            "D17" => "08:16:30",
            "D16" => "08:18:00",
            "D15" => "08:20:00",
            "B10" => "08:22:00",
            "B08" => "08:25:30",
            "B06" => "08:28:00",
            "B04" => "08:30:00",
            "G14" => "08:38:00",
            "G08" => "08:45:00",
            "F07" => "08:47:00",
            "F06" => "08:48:30",
            "F05" => "08:50:30",
            "F04" => "08:52:00",
            "F03" => "08:53:30",
            "F02" => "08:55:30",
            "F01" => "08:59:00",
          },
          true, false, false),
      ],
      south: [
        LongTermServiceChangeRegularRouting.new("FX", :south, "16:27:00",
          {
            "F01" => "16:57:00",
            "F02" => "16:58:30",
            "F03" => "17:00:30",
            "F04" => "17:02:00",
            "F05" => "17:04:00",
            "F06" => "17:06:00",
            "F07" => "17:07:30",
            "G08" => "17:09:30",
            "G14" => "17:16:30",
            "B04" => "17:23:00",
            "B06" => "17:25:00",
            "B08" => "17:27:30",
            "B10" => "17:30:00",
            "D15" => "17:31:30",
            "D16" => "17:33:00",
            "D17" => "17:34:30",
            "D18" => "17:36:30",
            "D19" => "17:38:30",
            "D20" => "17:40:30",
            "D21" => "17:43:30",
            "F14" => "17:45:00",
            "F15" => "17:47:00",
            "F16" => "17:48:30",
            "F18" => "17:51:30",
            "A41" => "17:53:00",
            "F24" => "18:00:00",
            "F27" => "18:04:00",
            "F29" => "18:06:00",
            "F30" => "18:08:00",
            "F31" => "18:09:00",
            "F32" => "18:10:00",
            "F33" => "18:12:00",
            "F34" => "18:13:30",
            "F35" => "18:15:00",
            "F36" => "18:21:00",
            "F38" => "18:23:00",
            "F39" => "18:29:00",
            "D42" => "18:30:30",
            "D43" => "18:32:00",
          },
          true, false, false),
      ]
    },
    "7X" => {
      north: [
        LongTermServiceChangeRegularRouting.new("7X", :north, "14:46:00",
          {
            "726" => "21:40:30",
            "725" => "21:43:00",
            "724" => "21:44:30",
            "723" => "21:46:00",
            "721" => "21:50:30",
            "720" => "21:51:30",
            "719" => "21:53:30",
            "718" => "21:55:00",
            "712" => "22:00:00",
            "707" => "22:03:30",
            "702" => "22:07:00",
            "701" => "22:10:30",
          },
          true, false, false),
      ],
      south: [
        LongTermServiceChangeRegularRouting.new("7X", :south, "06:21:00",
          {
            "701" => "09:53:00",
            "702" => "09:55:30",
            "707" => "09:59:30",
            "712" => "10:03:30",
            "718" => "10:09:00",
            "719" => "10:14:30",
            "720" => "10:16:30",
            "721" => "10:17:30",
            "723" => "10:22:30",
            "724" => "10:24:00",
            "725" => "10:25:30",
            "726" => "10:28:30",
          },
          true, false, false),
      ]
    },
    "E" => {
      north: [
        # Weekdays
        LongTermServiceChangeRegularRouting.new("E", :north, "00:00:00", # N05R
          {
            "E01" => "05:38:00",
            "A34" => "05:40:00",
            "A33" => "05:41:30",
            "A32" => "05:43:30",
            "A31" => "05:45:30",
            "A30" => "05:47:00",
            "A28" => "05:49:00",
            "A27" => "05:50:00",
            "A25" => "05:51:30",
            "D14" => "05:53:00",
            "F12" => "05:54:00",
            "F11" => "05:55:30",
            "F09" => "05:58:30",
            "G21" => "06:00:00",
            "G20" => "06:02:00",
            "G19" => "06:04:00",
            "G18" => "06:05:30",
            "G16" => "06:07:00",
            "G15" => "06:08:00",
            "G14" => "06:09:30",
            "G13" => "06:11:00",
            "G12" => "06:12:30",
            "G11" => "06:14:30",
            "G10" => "06:15:30",
            "G09" => "06:17:30",
            "G08" => "06:19:00",
            "F07" => "06:21:00",
            "F06" => "06:22:30",
            "F05" => "06:24:30",
            "G07" => "06:26:00",
            "G06" => "06:28:30",
            "G05" => "06:32:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "05:53:00", # N72R
          {
            "E01" => "06:52:30",
            "A34" => "06:54:30",
            "A33" => "06:56:00",
            "A32" => "06:58:00",
            "A31" => "07:00:30",
            "A30" => "07:02:00",
            "A28" => "07:04:00",
            "A27" => "07:05:30",
            "A25" => "07:07:30",
            "D14" => "07:09:00",
            "F12" => "07:11:30",
            "F11" => "07:13:00",
            "F09" => "07:16:00",
            "G21" => "07:17:30",
            "G14" => "07:23:00",
            "G08" => "07:30:00",
            "F07" => "07:32:00",
            "F06" => "07:33:30",
            "F05" => "07:35:30",
            "G07" => "07:37:00",
            "G06" => "07:39:00",
            "G05" => "07:44:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "07:00:30", # N66R
          {
            "E01" => "19:00:30",
            "A34" => "19:02:30",
            "A33" => "19:04:00",
            "A32" => "19:06:00",
            "A31" => "19:08:30",
            "A30" => "19:10:00",
            "A28" => "19:11:30",
            "A27" => "19:13:00",
            "A25" => "19:15:00",
            "D14" => "19:16:30",
            "F12" => "19:18:00",
            "F11" => "19:19:30",
            "F09" => "19:22:30",
            "G21" => "19:24:00",
            "G14" => "19:29:30",
            "G08" => "19:36:30",
            "F06" => "19:39:00",
            "G07" => "19:42:00",
            "G06" => "19:44:30",
            "G05" => "19:51:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "19:05:30", # N72R
          {
            "E01" => "23:38:00",
            "A34" => "23:40:00",
            "A33" => "23:41:30",
            "A32" => "23:43:30",
            "A31" => "23:45:30",
            "A30" => "23:47:00",
            "A28" => "23:49:00",
            "A27" => "23:50:00",
            "A25" => "23:52:00",
            "D14" => "23:53:30",
            "F12" => "23:54:30",
            "F11" => "23:56:00",
            "F09" => "23:59:00",
            "G21" => "24:00:30",
            "G14" => "24:06:00",
            "G08" => "24:13:00",
            "F07" => "24:15:00",
            "F06" => "24:16:30",
            "F05" => "24:18:30",
            "G07" => "24:20:00",
            "G06" => "24:22:30",
            "G05" => "24:30:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "23:50:00", # N05R
          {
            "E01" => nil,
            "A34" => nil,
            "A33" => nil,
            "A32" => nil,
            "A31" => nil,
            "A30" => nil,
            "A28" => nil,
            "A27" => nil,
            "A25" => nil,
            "D14" => nil,
            "F12" => nil,
            "F11" => nil,
            "F09" => nil,
            "G21" => nil,
            "G20" => nil,
            "G19" => nil,
            "G18" => nil,
            "G16" => nil,
            "G15" => nil,
            "G14" => nil,
            "G13" => nil,
            "G12" => nil,
            "G11" => nil,
            "G10" => nil,
            "G09" => nil,
            "G08" => nil,
            "F07" => nil,
            "F06" => nil,
            "F05" => nil,
            "G07" => nil,
            "G06" => nil,
            "G05" => nil,
          },
          true, false, false),

          # Saturdays
          LongTermServiceChangeRegularRouting.new("E", :north, "00:00:00", # N05R
          {
            "E01" => "05:48:30",
            "A34" => "05:50:30",
            "A33" => "05:52:00",
            "A32" => "05:54:00",
            "A31" => "05:56:00",
            "A30" => "05:57:30",
            "A28" => "05:59:30",
            "A27" => "06:00:30",
            "A25" => "06:02:00",
            "D14" => "06:03:30",
            "F12" => "06:04:30",
            "F11" => "06:06:00",
            "F09" => "06:09:00",
            "G21" => "06:10:30",
            "G20" => "06:12:30",
            "G19" => "06:14:30",
            "G18" => "06:16:00",
            "G16" => "06:17:30",
            "G15" => "06:18:30",
            "G14" => "06:20:00",
            "G13" => "06:21:30",
            "G12" => "06:23:00",
            "G11" => "06:25:00",
            "G10" => "06:26:00",
            "G09" => "06:28:00",
            "G08" => "06:29:30",
            "F07" => "06:31:30",
            "F06" => "06:33:00",
            "F05" => "06:35:00",
            "G07" => "06:38:30",
            "G06" => "06:41:00",
            "G05" => "06:48:00",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "06:08:30", # N72R
          {
            "E01" => "23:36:30",
            "A34" => "23:38:30",
            "A33" => "23:40:00",
            "A32" => "23:42:00",
            "A31" => "23:44:00",
            "A30" => "23:45:30",
            "A28" => "23:47:30",
            "A27" => "23:48:30",
            "A25" => "23:50:30",
            "D14" => "23:52:00",
            "F12" => "23:53:00",
            "F11" => "23:54:30",
            "F09" => "23:57:30",
            "G21" => "23:59:00",
            "G14" => "24:04:30",
            "G08" => "24:11:30",
            "F07" => "24:13:30",
            "F06" => "24:15:00",
            "F05" => "24:17:00",
            "G07" => "24:18:30",
            "G06" => "24:21:00",
            "G05" => "24:30:00",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("E", :north, "23:48:00", # N05R
          {
            "E01" => nil,
            "A34" => nil,
            "A33" => nil,
            "A32" => nil,
            "A31" => nil,
            "A30" => nil,
            "A28" => nil,
            "A27" => nil,
            "A25" => nil,
            "D14" => nil,
            "F12" => nil,
            "F11" => nil,
            "F09" => nil,
            "G21" => nil,
            "G20" => nil,
            "G19" => nil,
            "G18" => nil,
            "G16" => nil,
            "G15" => nil,
            "G14" => nil,
            "G13" => nil,
            "G12" => nil,
            "G11" => nil,
            "G10" => nil,
            "G09" => nil,
            "G08" => nil,
            "F07" => nil,
            "F06" => nil,
            "F05" => nil,
            "G07" => nil,
            "G06" => nil,
            "G05" => nil,
          },
          false, true, false),

        # Sundays
        LongTermServiceChangeRegularRouting.new("E", :north, "00:00:00", # N05R
          {
            "E01" => "05:48:30",
            "A34" => "05:50:30",
            "A33" => "05:52:00",
            "A32" => "05:54:00",
            "A31" => "05:56:00",
            "A30" => "05:57:30",
            "A28" => "05:59:30",
            "A27" => "06:00:30",
            "A25" => "06:02:00",
            "D14" => "06:03:30",
            "F12" => "06:04:30",
            "F11" => "06:06:00",
            "F09" => "06:09:00",
            "G21" => "06:10:30",
            "G20" => "06:12:30",
            "G19" => "06:14:30",
            "G18" => "06:16:00",
            "G16" => "06:17:30",
            "G15" => "06:18:30",
            "G14" => "06:20:00",
            "G13" => "06:21:30",
            "G12" => "06:23:00",
            "G11" => "06:25:00",
            "G10" => "06:26:00",
            "G09" => "06:28:00",
            "G08" => "06:29:30",
            "F07" => "06:31:30",
            "F06" => "06:33:00",
            "F05" => "06:35:00",
            "G07" => "06:38:30",
            "G06" => "06:41:00",
            "G05" => "06:49:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :north, "06:08:30", # N72R
          {
            "E01" => "23:34:30",
            "A34" => "23:36:30",
            "A33" => "23:38:00",
            "A32" => "23:40:00",
            "A31" => "23:42:00",
            "A30" => "23:43:30",
            "A28" => "23:45:30",
            "A27" => "23:46:30",
            "A25" => "23:48:30",
            "D14" => "23:50:00",
            "F12" => "23:51:00",
            "F11" => "23:52:30",
            "F09" => "23:55:30",
            "G21" => "23:57:00",
            "G14" => "24:02:30",
            "G08" => "24:09:30",
            "F07" => "24:11:30",
            "F06" => "24:13:00",
            "F05" => "24:15:00",
            "G07" => "24:16:30",
            "G06" => "24:19:00",
            "G05" => "24:29:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :north, "23:48:30", # N05R
          {
            "E01" => nil,
            "A34" => nil,
            "A33" => nil,
            "A32" => nil,
            "A31" => nil,
            "A30" => nil,
            "A28" => nil,
            "A27" => nil,
            "A25" => nil,
            "D14" => nil,
            "F12" => nil,
            "F11" => nil,
            "F09" => nil,
            "G21" => nil,
            "G20" => nil,
            "G19" => nil,
            "G18" => nil,
            "G16" => nil,
            "G15" => nil,
            "G14" => nil,
            "G13" => nil,
            "G12" => nil,
            "G11" => nil,
            "G10" => nil,
            "G09" => nil,
            "G08" => nil,
            "F07" => nil,
            "F06" => nil,
            "F05" => nil,
            "G07" => nil,
            "G06" => nil,
            "G05" => nil,
          },
          false, false, true),
      ],
      south: [
        # Weekdays
        LongTermServiceChangeRegularRouting.new("E", :south, "00:00:00", # S04R
          {
            "G05" => "05:05:30",
            "G06" => "05:07:00",
            "G07" => "05:09:30",
            "F05" => "05:11:00",
            "F06" => "05:12:30",
            "F07" => "05:14:00",
            "G08" => "05:15:30",
            "G09" => "05:17:00",
            "G10" => "05:19:00",
            "G11" => "05:20:00",
            "G12" => "05:22:00",
            "G13" => "05:23:30",
            "G14" => "05:25:00",
            "G15" => "05:26:30",
            "G16" => "05:28:00",
            "G18" => "05:29:30",
            "G19" => "05:31:00",
            "G20" => "05:33:00",
            "G21" => "05:35:00",
            "F09" => "05:36:30",
            "F11" => "05:39:30",
            "F12" => "05:41:00",
            "D14" => "05:42:30",
            "A25" => "05:44:00",
            "A27" => "05:47:30",
            "A28" => "05:48:30",
            "A30" => "05:50:00",
            "A31" => "05:51:30",
            "A32" => "05:53:30",
            "A33" => "05:55:00",
            "A34" => "05:56:30",
            "E01" => "05:58:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "05:22:30", # S69R
          {
            "G05" => "05:58:00",
            "G06" => "05:59:30",
            "G07" => "06:02:00",
            "F05" => "06:03:30",
            "F06" => "06:05:30",
            "F07" => "06:07:00",
            "G08" => "06:09:00",
            "G14" => "06:16:00",
            "G21" => "06:22:00",
            "F09" => "06:23:30",
            "F11" => "06:26:30",
            "F12" => "06:28:00",
            "D14" => "06:29:30",
            "A25" => "06:31:00",
            "A27" => "06:34:30",
            "A28" => "06:35:30",
            "A30" => "06:37:00",
            "A31" => "06:38:30",
            "A32" => "06:40:30",
            "A33" => "06:42:00",
            "A34" => "06:43:30",
            "E01" => "06:45:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "06:07:00", # S71R
          {
            "G05" => "17:56:00",
            "G06" => "17:57:30",
            "G07" => "18:03:00",
            "F06" => "18:06:00",
            "G08" => "18:08:30",
            "G14" => "18:15:30",
            "G21" => "18:21:30",
            "F09" => "18:23:00",
            "F11" => "18:26:30",
            "F12" => "18:28:30",
            "D14" => "18:30:30",
            "A25" => "18:32:00",
            "A27" => "18:34:00",
            "A28" => "18:35:30",
            "A30" => "18:37:30",
            "A31" => "18:39:00",
            "A32" => "18:41:30",
            "A33" => "18:43:00",
            "A34" => "18:44:30",
            "E01" => "18:46:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "18:02:00", # S69R
          {
            "G05" => "22:30:30",
            "G06" => "22:32:00",
            "G07" => "22:34:30",
            "F05" => "22:36:00",
            "F06" => "22:38:00",
            "F07" => "22:39:30",
            "G08" => "22:41:30",
            "G14" => "22:48:30",
            "G21" => "22:54:30",
            "F09" => "22:56:00",
            "F11" => "22:59:00",
            "F12" => "23:00:30",
            "D14" => "23:02:00",
            "A25" => "23:03:30",
            "A27" => "23:08:30",
            "A28" => "23:09:30",
            "A30" => "23:11:00",
            "A31" => "23:12:30",
            "A32" => "23:14:30",
            "A33" => "23:16:00",
            "A34" => "23:17:30",
            "E01" => "23:19:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "22:36:00", # S04R
          {
            "G05" => nil,
            "G06" => nil,
            "G07" => nil,
            "F05" => nil,
            "F06" => nil,
            "F07" => nil,
            "G08" => nil,
            "G09" => nil,
            "G10" => nil,
            "G11" => nil,
            "G12" => nil,
            "G13" => nil,
            "G14" => nil,
            "G15" => nil,
            "G16" => nil,
            "G18" => nil,
            "G19" => nil,
            "G20" => nil,
            "G21" => nil,
            "F09" => nil,
            "F11" => nil,
            "F12" => nil,
            "D14" => nil,
            "A25" => nil,
            "A27" => nil,
            "A28" => nil,
            "A30" => nil,
            "A31" => nil,
            "A32" => nil,
            "A33" => nil,
            "A34" => nil,
            "E01" => nil,
          },
          true, false, false),

        # Saturdays
        LongTermServiceChangeRegularRouting.new("E", :south, "00:00:00", # S04R
          {
            "G05" => "05:13:30",
            "G06" => "05:15:00",
            "G07" => "05:17:30",
            "F05" => "05:19:00",
            "F06" => "05:20:30",
            "F07" => "05:22:00",
            "G08" => "05:23:30",
            "G09" => "05:25:00",
            "G10" => "05:27:00",
            "G11" => "05:28:00",
            "G12" => "05:30:00",
            "G13" => "05:31:30",
            "G14" => "05:33:00",
            "G15" => "05:34:30",
            "G16" => "05:36:00",
            "G18" => "05:37:30",
            "G19" => "05:39:00",
            "G20" => "05:41:00",
            "G21" => "05:43:00",
            "F09" => "05:44:30",
            "F11" => "05:47:30",
            "F12" => "05:49:00",
            "D14" => "05:50:30",
            "A25" => "05:52:00",
            "A27" => "05:56:30",
            "A28" => "05:57:30",
            "A30" => "05:59:00",
            "A31" => "06:00:30",
            "A32" => "06:02:30",
            "A33" => "06:04:00",
            "A34" => "06:05:30",
            "E01" => "06:10:30",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "05:33:00", # S69R
          {
            "G05" => "22:21:00",
            "G06" => "22:22:30",
            "G07" => "22:24:30",
            "F05" => "22:26:00",
            "F06" => "22:28:00",
            "F07" => "22:29:30",
            "G08" => "22:31:30",
            "G14" => "22:38:30",
            "G21" => "22:44:30",
            "F09" => "22:46:00",
            "F11" => "22:49:00",
            "F12" => "22:50:30",
            "D14" => "22:52:00",
            "A25" => "22:53:30",
            "A27" => "22:58:30",
            "A28" => "22:59:30",
            "A30" => "23:01:00",
            "A31" => "23:02:30",
            "A32" => "23:04:30",
            "A33" => "23:06:00",
            "A34" => "23:07:30",
            "E01" => "23:09:30",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("E", :south, "22:30:00", # S04R
          {
            "G05" => nil,
            "G06" => nil,
            "G07" => nil,
            "F05" => nil,
            "F06" => nil,
            "F07" => nil,
            "G08" => nil,
            "G09" => nil,
            "G10" => nil,
            "G11" => nil,
            "G12" => nil,
            "G13" => nil,
            "G14" => nil,
            "G15" => nil,
            "G16" => nil,
            "G18" => nil,
            "G19" => nil,
            "G20" => nil,
            "G21" => nil,
            "F09" => nil,
            "F11" => nil,
            "F12" => nil,
            "D14" => nil,
            "A25" => nil,
            "A27" => nil,
            "A28" => nil,
            "A30" => nil,
            "A31" => nil,
            "A32" => nil,
            "A33" => nil,
            "A34" => nil,
            "E01" => nil,
          },
          false, true, false),

        # Sundays
        LongTermServiceChangeRegularRouting.new("E", :south, "00:00:00", # S04R
          {
            "G05" => "04:53:30",
            "G06" => "04:55:00",
            "G07" => "04:57:30",
            "F05" => "04:59:00",
            "F06" => "05:00:30",
            "F07" => "05:02:00",
            "G08" => "05:03:30",
            "G09" => "05:05:00",
            "G10" => "05:07:00",
            "G11" => "05:08:00",
            "G12" => "05:10:00",
            "G13" => "05:11:30",
            "G14" => "05:13:00",
            "G15" => "05:14:30",
            "G16" => "05:16:00",
            "G18" => "05:17:30",
            "G19" => "05:19:00",
            "G20" => "05:21:00",
            "G21" => "05:23:00",
            "F09" => "05:24:30",
            "F11" => "05:27:30",
            "F12" => "05:29:00",
            "D14" => "05:30:30",
            "A25" => "05:32:00",
            "A27" => "05:37:00",
            "A28" => "05:38:00",
            "A30" => "05:39:30",
            "A31" => "05:41:00",
            "A32" => "05:43:00",
            "A33" => "05:44:30",
            "A34" => "05:46:00",
            "E01" => "05:51:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :south, "05:13:30", # S69R
          {
            "G05" => "22:18:00",
            "G06" => "22:19:30",
            "G07" => "22:22:00",
            "F05" => "22:23:30",
            "F06" => "22:25:30",
            "F07" => "22:27:00",
            "G08" => "22:29:00",
            "G14" => "22:36:00",
            "G21" => "22:42:00",
            "F09" => "22:43:30",
            "F11" => "22:46:30",
            "F12" => "22:48:00",
            "D14" => "22:49:30",
            "A25" => "22:51:00",
            "A27" => "22:56:00",
            "A28" => "22:57:00",
            "A30" => "22:58:30",
            "A31" => "23:00:00",
            "A32" => "23:02:00",
            "A33" => "23:03:30",
            "A34" => "23:05:00",
            "E01" => "23:07:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :south, "22:28:00", # S04R
          {
            "G05" => nil,
            "G06" => nil,
            "G07" => nil,
            "F05" => nil,
            "F06" => nil,
            "F07" => nil,
            "G08" => nil,
            "G09" => nil,
            "G10" => nil,
            "G11" => nil,
            "G12" => nil,
            "G13" => nil,
            "G14" => nil,
            "G15" => nil,
            "G16" => nil,
            "G18" => nil,
            "G19" => nil,
            "G20" => nil,
            "G21" => nil,
            "F09" => nil,
            "F11" => nil,
            "F12" => nil,
            "D14" => nil,
            "A25" => nil,
            "A27" => nil,
            "A28" => nil,
            "A30" => nil,
            "A31" => nil,
            "A32" => nil,
            "A33" => nil,
            "A34" => nil,
            "E01" => nil,
          },
          false, false, true),
      ]
    },
    "M" => {
      north: [
        # Weekdays
        LongTermServiceChangeRegularRouting.new("M", :north, "00:00:00", # M30R
          {
            "M01" => "05:44:00",
            "M04" => "05:46:00",
            "M05" => "05:47:30",
            "M06" => "05:48:30",
            "M08" => "05:50:00",
            "M09" => "05:52:00",
            "M10" => "05:54:00",
            "M11" => "05:56:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("M", :north, "05:14:00", # N20R
          {
            "M01" => "20:37:30",
            "M04" => "20:40:00",
            "M05" => "20:42:00",
            "M06" => "20:43:30",
            "M08" => "20:45:00",
            "M09" => "20:47:00",
            "M10" => "20:49:00",
            "M11" => "20:51:30",
            "M12" => "20:53:30",
            "M13" => "20:55:00",
            "M14" => "20:56:00",
            "M16" => "20:57:00",
            "M18" => "21:04:30",
            "D21" => "21:07:30",
            "D20" => "21:10:30",
            "D19" => "21:12:30",
            "D18" => "21:14:00",
            "D17" => "21:16:00",
            "D16" => "21:17:30",
            "D15" => "21:19:30",
            "F12" => "21:21:30",
            "F11" => "21:25:30",
            "F09" => "21:28:30",
            "G21" => "21:30:00",
            "G20" => "21:32:00",
            "G19" => "21:34:00",
            "G18" => "21:36:00",
            "G16" => "21:37:30",
            "G15" => "21:39:30",
            "G14" => "21:41:00",
            "G13" => "21:46:00",
            "G12" => "21:48:00",
            "G11" => "21:50:00",
            "G10" => "21:52:00",
            "G09" => "21:54:00",
            "G08" => "21:56:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("M", :north, "20:47:30", # N25R
          {
            "M01" => "23:10:00",
            "M04" => "23:12:00",
            "M05" => "23:13:30",
            "M06" => "23:14:30",
            "M08" => "23:16:00",
            "M09" => "23:18:00",
            "M10" => "23:20:00",
            "M11" => "23:22:30",
            "M12" => "23:24:00",
            "M13" => "23:25:30",
            "M14" => "23:26:30",
            "M16" => "23:27:30",
            "M18" => "23:36:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("M", :north, "23:20:00", # N72R
          {
            "M01" => nil,
            "M04" => nil,
            "M05" => nil,
            "M06" => nil,
            "M08" => nil,
            "M09" => nil,
            "M10" => nil,
            "M11" => nil,
          },
          true, false, false),

          # Saturdays and Sundays not included, since there are no changes
      ],
      south: [
        # Weekdays
        LongTermServiceChangeRegularRouting.new("M", :south, "00:00:00", # S30R
          {
            "M11" => "06:02:00",
            "M10" => "06:04:30",
            "M09" => "06:06:00",
            "M08" => "06:08:00",
            "M06" => "06:09:30",
            "M05" => "06:10:30",
            "M04" => "06:12:00",
            "M01" => "06:14:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("M", :south, "05:44:00", # S20R
          {
            "G08" => "20:27:00",
            "G09" => "20:29:00",
            "G10" => "20:30:30",
            "G11" => "20:32:00",
            "G12" => "20:34:00",
            "G13" => "20:35:30",
            "G14" => "20:37:30",
            "G15" => "20:39:00",
            "G16" => "20:40:30",
            "G18" => "20:42:00",
            "G19" => "20:44:00",
            "G20" => "20:46:00",
            "G21" => "20:48:00",
            "F09" => "20:50:00",
            "F11" => "20:53:00",
            "F12" => "20:54:30",
            "D15" => "20:56:30",
            "D16" => "21:00:00",
            "D17" => "21:01:30",
            "D18" => "21:03:30",
            "D19" => "21:05:00",
            "D20" => "21:07:00",
            "D21" => "21:09:30",
            "M18" => "21:12:30",
            "M16" => "21:20:00",
            "M14" => "21:21:00",
            "M13" => "21:22:30",
            "M12" => "21:24:00",
            "M11" => "21:25:00",
            "M10" => "21:27:00",
            "M09" => "21:29:00",
            "M08" => "21:30:30",
            "M06" => "21:32:00",
            "M05" => "21:33:30",
            "M04" => "21:35:00",
            "M01" => "21:37:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("M", :south, "21:21:30", # S25R
          {
            "M18" => "23:26:30",
            "M16" => "23:34:00",
            "M14" => "23:35:00",
            "M13" => "23:36:30",
            "M12" => "23:38:00",
            "M11" => "23:39:00",
            "M10" => "23:41:00",
            "M09" => "23:43:00",
            "M08" => "23:44:30",
            "M06" => "23:46:00",
            "M05" => "23:47:30",
            "M04" => "23:49:00",
            "M01" => "23:51:30",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("M", :south, "23:45:00", # S30R
          {
            "M11" => nil,
            "M10" => nil,
            "M09" => nil,
            "M08" => nil,
            "M06" => nil,
            "M05" => nil,
            "M04" => nil,
            "M01" => nil,
          },
          true, false, false),

          # Saturdays and Sundays not included, since there are no changes
      ]
    },
    "R" => {
      north: [
        # Weekdays
        LongTermServiceChangeRegularRouting.new("R", :north, "00:00:00", # N27R
          {
            "R45" => "05:06:00",
            "R44" => "05:07:30",
            "R43" => "05:09:30",
            "R42" => "05:11:00",
            "R41" => "05:13:00",
            "R40" => "05:14:30",
            "R39" => "05:16:00",
            "R36" => "05:18:30",
            "R35" => "05:20:00",
            "R34" => "05:21:30",
            "R33" => "05:23:30",
            "R32" => "05:25:00",
            "R31" => "05:27:00",
            "R30" => "05:30:00",
            "R29" => "05:31:30",
            "R28" => "05:33:00",
            "R27" => "05:37:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("R", :north, "05:18:30", # N72R
          {
            "R45" => "22:56:30",
            "R44" => "22:58:00",
            "R43" => "23:00:00",
            "R42" => "23:01:30",
            "R41" => "23:03:30",
            "R40" => "23:05:30",
            "R39" => "23:07:00",
            "R36" => "23:09:30",
            "R35" => "23:11:30",
            "R34" => "23:13:00",
            "R33" => "23:15:00",
            "R32" => "23:17:00",
            "R31" => "23:19:00",
            "R30" => "23:22:00",
            "R29" => "23:23:30",
            "R28" => "23:25:00",
            "R27" => "23:28:30",
            "R26" => "23:30:30",
            "R25" => "23:31:30",
            "R24" => "23:33:30",
            "R23" => "23:36:00",
            "R22" => "23:37:30",
            "R21" => "23:39:00",
            "R20" => "23:40:30",
            "R19" => "23:42:00",
            "R18" => "23:43:00",
            "R17" => "23:44:00",
            "R16" => "23:45:30",
            "R15" => "23:47:00",
            "R14" => "23:48:30",
            "R13" => "23:51:00",
            "R11" => "23:52:30",
            "G21" => "23:58:00",
            "G20" => "24:00:00",
            "G19" => "24:02:00",
            "G18" => "24:04:00",
            "G16" => "24:05:30",
            "G15" => "24:07:00",
            "G14" => "24:08:30",
            "G13" => "24:13:00",
            "G12" => "24:14:30",
            "G11" => "24:16:30",
            "G10" => "24:17:30",
            "G09" => "24:19:30",
            "G08" => "24:21:00",
          },
          true, false, false),
        LongTermServiceChangeRegularRouting.new("R", :north, "22:52:00", # N93R
          {
            "R45" => nil,
            "R44" => nil,
            "R43" => nil,
            "R42" => nil,
            "R41" => nil,
            "R40" => nil,
            "R39" => nil,
            "R36" => nil,
            "R35" => nil,
            "R34" => nil,
            "R33" => nil,
            "R32" => nil,
            "R31" => nil,
            "R30" => nil,
            "R29" => nil,
            "R28" => nil,
            "R27" => nil,
          },
          true, false, false),

          # Saturdays
          LongTermServiceChangeRegularRouting.new("R", :north, "00:00:00", # N27R
          {
            "R45" => "05:06:00",
            "R44" => "05:07:30",
            "R43" => "05:09:30",
            "R42" => "05:11:00",
            "R41" => "05:13:00",
            "R40" => "05:14:30",
            "R39" => "05:16:00",
            "R36" => "05:18:30",
            "R35" => "05:20:00",
            "R34" => "05:21:30",
            "R33" => "05:23:30",
            "R32" => "05:25:00",
            "R31" => "05:27:00",
            "R30" => "05:30:00",
            "R29" => "05:31:30",
            "R28" => "05:33:00",
            "R27" => "05:37:00",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("R", :north, "05:24:00", # N93R
          {
            "R45" => "22:59:00",
            "R44" => "23:00:30",
            "R43" => "23:02:30",
            "R42" => "23:04:00",
            "R41" => "23:06:00",
            "R40" => "23:07:30",
            "R39" => "23:09:00",
            "R36" => "23:11:30",
            "R35" => "23:13:00",
            "R34" => "23:14:30",
            "R33" => "23:16:30",
            "R32" => "23:18:00",
            "R31" => "23:20:00",
            "R30" => "23:23:00",
            "R29" => "23:24:30",
            "R28" => "23:26:00",
            "R27" => "23:29:30",
            "R26" => "23:31:00",
            "R25" => "23:32:30",
            "R24" => "23:34:00",
            "R23" => "23:36:30",
            "R22" => "23:38:00",
            "R21" => "23:39:30",
            "R20" => "23:41:00",
            "R19" => "23:42:30",
            "R18" => "23:43:30",
            "R17" => "23:44:30",
            "R16" => "23:46:00",
            "R15" => "23:47:30",
            "R14" => "23:49:00",
            "R13" => "23:51:30",
            "R11" => "23:53:00",
            "G21" => "23:58:30",
            "G20" => "24:02:00",
            "G19" => "24:04:00",
            "G18" => "24:05:30",
            "G16" => "24:07:00",
            "G15" => "24:08:00",
            "G14" => "24:09:30",
            "G13" => "24:14:00",
            "G12" => "24:15:30",
            "G11" => "24:17:30",
            "G10" => "24:18:30",
            "G09" => "24:20:30",
            "G08" => "24:22:00",
          },
          false, true, false),
        LongTermServiceChangeRegularRouting.new("R", :north, "22:54:00", # N27R
          {
            "R45" => nil,
            "R44" => nil,
            "R43" => nil,
            "R42" => nil,
            "R41" => nil,
            "R40" => nil,
            "R39" => nil,
            "R36" => nil,
            "R35" => nil,
            "R34" => nil,
            "R33" => nil,
            "R32" => nil,
            "R31" => nil,
            "R30" => nil,
            "R29" => nil,
            "R28" => nil,
            "R27" => nil,
          },
          false, true, false),

        # Sundays
        LongTermServiceChangeRegularRouting.new("R", :north, "00:00:00", # N27R
          {
            "R45" => "05:06:00",
            "R44" => "05:07:30",
            "R43" => "05:09:30",
            "R42" => "05:11:00",
            "R41" => "05:13:00",
            "R40" => "05:14:30",
            "R39" => "05:16:00",
            "R36" => "05:18:30",
            "R35" => "05:20:00",
            "R34" => "05:21:30",
            "R33" => "05:23:30",
            "R32" => "05:25:00",
            "R31" => "05:27:00",
            "R30" => "05:30:00",
            "R29" => "05:31:30",
            "R28" => "05:33:00",
            "R27" => "05:37:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("R", :north, "05:26:00", # N93R
          {
            "R45" => "22:57:00",
            "R44" => "22:58:30",
            "R43" => "23:00:30",
            "R42" => "23:02:00",
            "R41" => "23:04:00",
            "R40" => "23:05:30",
            "R39" => "23:07:00",
            "R36" => "23:09:30",
            "R35" => "23:11:00",
            "R34" => "23:12:30",
            "R33" => "23:14:30",
            "R32" => "23:16:00",
            "R31" => "23:18:00",
            "R30" => "23:21:00",
            "R29" => "23:24:30",
            "R28" => "23:26:00",
            "R27" => "23:29:30",
            "R26" => "23:31:00",
            "R25" => "23:32:30",
            "R24" => "23:34:00",
            "R23" => "23:36:30",
            "R22" => "23:38:00",
            "R21" => "23:39:30",
            "R20" => "23:41:00",
            "R19" => "23:42:30",
            "R18" => "23:43:30",
            "R17" => "23:44:30",
            "R16" => "23:46:00",
            "R15" => "23:47:30",
            "R14" => "23:49:00",
            "R13" => "23:51:30",
            "R11" => "23:53:00",
            "G21" => "23:58:30",
            "G20" => "24:02:00",
            "G19" => "24:04:00",
            "G18" => "24:05:30",
            "G16" => "24:07:00",
            "G15" => "24:08:00",
            "G14" => "24:09:30",
            "G13" => "24:14:00",
            "G12" => "24:15:30",
            "G11" => "24:17:30",
            "G10" => "24:18:30",
            "G09" => "24:20:30",
            "G08" => "24:22:00",
          },
          false, false, true),
        LongTermServiceChangeRegularRouting.new("E", :north, "23:48:30", # N05R
          {
            "R45" => nil,
            "R44" => nil,
            "R43" => nil,
            "R42" => nil,
            "R41" => nil,
            "R40" => nil,
            "R39" => nil,
            "R36" => nil,
            "R35" => nil,
            "R34" => nil,
            "R33" => nil,
            "R32" => nil,
            "R31" => nil,
            "R30" => nil,
            "R29" => nil,
            "R28" => nil,
            "R27" => nil,
          },
          false, false, true),
      ],
      south: [ # No changes to timetable for R southbound
      ],
    }
  }

  DAY_OF_WEEK_OVERRIDE = {
    Date.parse("Thu, 23 Nov 2023") => "Sunday"
  }


  def self.get_routing(route_id, direction, time = Scheduled::StopTime.rounded_time)
    return [] unless ENV["SIXTY_THIRD_STREET_SERVICE_CHANGES"] == "true"

    current_timestamp = Time.zone.at(time)
    schedule = SCHEDULED_ROUTING_OVERRIDES[route_id].try(:[], direction)

    return [] unless schedule.present?
    timestamp_from_beginning_of_day = current_timestamp - current_timestamp.beginning_of_day
    today = Date.current
    yesterday = today - 1.day
    current_day_of_week = DAY_OF_WEEK_OVERRIDE[today] || get_schedule(today)
    prev_day_of_week = DAY_OF_WEEK_OVERRIDE[yesterday] || get_schedule(yesterday)

    # Consolidate routings
    routings = schedule.map { |s|
      s.get_applicable_routing(timestamp_from_beginning_of_day, current_day_of_week, prev_day_of_week)
    }.compact.flatten(1)
    routings.select { |selected_routing|
      others = routings - [selected_routing]
      selected_routing.length > 0 && others.none? {|o| o.each_cons(selected_routing.length).any?(&selected_routing.method(:==))}
    }
  end

  def self.get_all_routings(time = Scheduled::StopTime.rounded_time)
    return {} unless ENV["SIXTY_THIRD_STREET_SERVICE_CHANGES"] == "true"

    SCHEDULED_ROUTING_OVERRIDES.keys.to_h { |route_id|
      [route_id, [:north, :south].to_h { |direction|
          [direction, get_routing(route_id, direction, time)]
        }
      ]
    }
  end

  def self.get_schedule(date)
    if date.saturday?
      "Saturday"
    elsif date.sunday?
      "Sunday"
    else
      "Weekday"
    end
  end
end